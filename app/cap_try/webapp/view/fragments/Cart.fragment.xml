<core:FragmentDefinition
	xmlns="sap.m"
	xmlns:core="sap.ui.core"
    xmlns:table="sap.ui.table"
>
    <Dialog title="{i18n>shopping_cart}" id="Cart">
        <content>
            <table:Table id="cartTable"
                         visibleRowCount="5"
                         selectionMode="MultiToggle"
                         alternateRowColors="true"
                         class="sapUiSmallMargin">
                <table:extension>
                    <OverflowToolbar>
                            <Button text="{i18n>add_cart}" iconFirst="true" icon="sap-icon://add" press="onAddCartButtonPress" />
                        <ToolbarSeparator />
                            <Label text="{i18n>carts}" design="Bold" />
                            <Select autoAdjustWidth="false" columnRatio="3:2" forceSelection="false" id="cartsSelect"
                                    icon="sap-icon://cart" maxWidth="100%" items="{ path: '/Cart',
                                                                                    filters: [ { path: 'status', operator: 'EQ', value1: 'Active' } ],
                                                                                    sorter: { path: 'createdAt', descending: false } }" 
                                    change="onCartsSelectChange" resetOnMissingKey="false" width="10%" wrapItemsText="false"
                                    enabled="true" >
                                <items>
                                    <core:Item key="{ID}" text="{name}" />
                                </items>
                            </Select>
                            <Button icon="sap-icon://delete"
                                    type="Transparent"
                                    visible="{= Object.keys(${globalModel>/selectedCart}).length > 0}"
                                    tooltip="{i18n>delete_current_cart}"
                                    class="sapUiTinyMarginBegin"
                                    press="onDeleteSelectedCartPress"
                                    enabled="true" />
                        <ToolbarSpacer />
                        <ToolbarSpacer />
                            <Title level="H2" text="{i18n>total}" titleStyle="Auto" width="" wrapping="false" wrappingType="Normal" />
                    </OverflowToolbar>
                </table:extension>
                <table:columns>
                    <table:Column width="20%">
                        <Label text="{i18n>name}" />
                        <table:template>
                            <Text text="{product/name}" />
                        </table:template>
                    </table:Column>
                    <table:Column width="20%">
                        <Label text="{i18n>description}" />
                        <table:template>
                            <Text text="{product/description}" />
                        </table:template>
                    </table:Column>
                    <table:Column width="20%">
                        <Label text="{i18n>price}" />
                        <table:template>
                            <ObjectNumber number="{product/price}"
                                          unit="{globalModel>/selectedCompany/currency}" />
                        </table:template>
                    </table:Column>
                    <table:Column width="20%">
                        <Label text="{i18n>quantity}" />
                        <table:template>
                            <StepInput change="onProductCartQuantityChangePress" value="{quantity}" />
                        </table:template>
                    </table:Column>
                    <table:Column width="20%">
                        <Label text="{i18n>total}" />
                        <table:template>
                            <ObjectNumber number="{total_price}"
                                          unit="{globalModel>/selectedCompany/currency}" />
                        </table:template>
                    </table:Column>
                    <table:Column width="5rem">
                        <Label text="{i18n>delete}" />
                        <table:template >
                            <Button icon="sap-icon://delete"
                                    type="Transparent"
                                    tooltip="{i18n>delete_cart_item}"
                                    press="onDeleteCartItemPress" />
                        </table:template>
                    </table:Column>
                </table:columns>
                <table:footer>
                    <OverflowToolbar id="cartTableFooter">
                        <Button icon="sap-icon://delete" text="{i18n>delete_cart_items}"
                                press="onDeleteMultipleCartItemPress" visible="{= ${globalModel>/cartItemsQuantity} > 0 }" />
                        <ToolbarSeparator visible="{= ${globalModel>/cart}.length === 0 ? false : true}" />
                        <ToolbarSpacer />
                        <Label text="{i18n>cart_total}" design="Bold" />
                        <Text class="sapUiTinyMarginBegin" text="{cart_total}" />
                    </OverflowToolbar>
                </table:footer>
            </table:Table>
        </content>
        <beginButton>
            <Button text="{i18n>finalize_purchase}" visible="{= ${globalModel>/cartItemsQuantity} === 0 ? false : true}" 
                    press="onFinalizePurchasePress" type="Success" />
        </beginButton>
        <endButton>
            <Button text="{i18n>close}" type="Default" press="closeCartDialog" />
        </endButton>
    </Dialog>
</core:FragmentDefinition>