<c:FragmentDefinition
	xmlns="sap.m"
	xmlns:c="sap.ui.core"
    xmlns:core="sap.ui.core"
    xmlns:table="sap.ui.table"
    xmlns:u="sap.ui.unified">
    
    <Title text="{i18n>products_list}" level="H3" />
        <Table id="productsWorklist"
               mode="MultiSelect"
               inset="false"
               items="{ path: 'products',
                        parameters: { $$updateGroupId: 'updateProducts'},
                        sorter: { path: 'name' } }"
        alternateRowColors="true">
        <headerToolbar>
            <OverflowToolbar>
                <Title text="{i18n>products_list}" level="H2"/>
                <ToolbarSpacer />
                <SearchField
                    width="30%"
                    placeholder="{i18n>search_by_name}"
                    liveChange="onSearch" />
                <u:FileUploader id="excelUploader"
                                fileType="xlsx,xls"
                                buttonOnly="true"
                                iconOnly="true"
                                icon="sap-icon://upload"
                                sendXHR="true"
                                useMultipart="false"
                                change="onUploadTemplatePress" />
                <Button 
                    icon="sap-icon://download"
                    press="onDownloadTemplatePress" />
                <ToolbarSeparator />
                <Button 
                    press="openAddProductDialog" 
                    visible="{= ${globalModel>/userInfo/roles}.includes('admin') }"
                    icon="sap-icon://add-product"
                    tooltip="{i18n>add_product}" />
                <ToolbarSeparator visible="{= ${globalModel>/userInfo/roles}.includes('admin') }" />
                <Button
                    icon="sap-icon://delete"
                    type="Transparent"
                    tooltip="{i18n>delete_selected_products}"
                    visible="{= ${globalModel>/userInfo/roles}.includes('admin') }"
                    class="sapUiTinyMarginBegin"
                    press="onDeleteMultiplesProductsPress" />
                <ToolbarSeparator visible="{= ${globalModel>/userInfo/roles}.includes('admin') }" />
                <Button icon="sap-icon://cart-4"
                        tooltip="{i18n>add_product_to_cart}"
                        press="addProductCart" />
            </OverflowToolbar>
        </headerToolbar>

        <columns>
            <Column width="4rem" hAlign="Center">
                <header>
                    <Label text="{i18n>status}" />
                </header>
            </Column>

            <Column>
                <header>
                    <Label text="{i18n>name}" />
                </header>
            </Column>
            <Column>
                <header>
                    <Label text="{i18n>description}" />
                </header>
            </Column>

            <Column hAlign="End" minScreenWidth="Tablet" demandPopin="true">
                <header>
                    <Label text="{i18n>price}" />
                </header>
            </Column>

            <Column hAlign="End" minScreenWidth="Desktop" demandPopin="true">
                <header>
                    <Label text="{i18n>stock} / {i18n>stock_min}" />
                </header>
            </Column>
            <Column hAlign="Center" minScreenWidth="Tablet" 
                    demandPopin="true" width="10rem"
                    visible="{= ${globalModel>/userInfo/roles}.includes('admin') }">
                <header>
                    <Label text="{i18n>edit}" />
                </header>
            </Column>
            <Column hAlign="Center" minScreenWidth="Tablet" 
                    demandPopin="true" width="10rem"
                    visible="{= ${globalModel>/userInfo/roles}.includes('admin') }">
                <header>
                    <Label text="{i18n>delete}" />
                </header>
            </Column>
        </columns>

        <items>
            <ColumnListItem vAlign="Middle"
                            type="Inactive"
                            highlight="{ parts: [ { 'path': 'stock', targetType: 'any' },
                                       { 'path': 'stock_min', targetType: 'any' } ], formatter: '.formatter.stockStateFormatter'}">
                <cells>
                    <core:Icon src="{ parts: [ { 'path': 'stock', targetType: 'any' },
                                    { 'path': 'stock_min', targetType: 'any' } ], formatter: '.formatter.stockIconFormatter'}"
                               tooltip=""
                               class="sapUiSmallMargin"
                               color="{ parts: [ { 'path': 'stock', targetType: 'any' },
                                      { 'path': 'stock_min', targetType: 'any' } ], formatter: '.formatter.stockIconColorFormatter'}" />
                    
                    <ObjectIdentifier title="{name}" />

                    <ObjectIdentifier text="{description}" />
                    
                    <ObjectNumber number="{ parts: [ { path: 'price' },
                                                     { path: 'globalModel>/selectedCompany/currency_code' }  ],
                                            type: 'sap.ui.model.type.Currency',
                                            formatOptions: { showMeasure: false } }" unit="{currency}" />
                    
                    <VBox alignItems="End"> 
                        <ObjectNumber number="{ path: 'stock', type: 'sap.ui.model.type.Integer' }"
                                      state="{ parts: [ { path: 'stock', targetType: 'any' }, 
                                                        { path: 'stock_min', targetType: 'any' } ], 
                                               formatter: '.formatter.stockStateFormatter' }" />
                        <ObjectNumber number="{ path: 'stock_min', type: 'sap.ui.model.type.Integer' }" unit="Min" />
                    </VBox>

                    <Button icon="sap-icon://edit"
                            type="Transparent"
                            tooltip="{i18n>edit_product}"
                            press="onEditProductPress" />
                    <Button icon="sap-icon://delete"
                            type="Transparent"
                            tooltip="{i18n>delete_products}"
                            press="onDeleteProductPress" />
                </cells>
            </ColumnListItem>
        </items>
    </Table>
</c:FragmentDefinition>